{% extends "base.html" %}
{% load socialaccount %}
{% load i18n %}

{% block title %}Social Account Connections - DreamWedAI{% endblock title %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">
      
      <!-- Page Header -->
      <div class="text-center mb-5">
        <div class="feature-icon mx-auto mb-3 bg-gradient-rose">
          <i class="bi bi-person-gear"></i>
        </div>
        <h2 class="fw-bold">Social Account Connections</h2>
        <p class="text-muted">Connect your social accounts for quick and easy login to DreamWedAI</p>
      </div>

      <!-- Connected Accounts Section -->
      {% if form.accounts %}
      <div class="card shadow-lg border-0 mb-4">
        <div class="card-header bg-gradient-cyan text-white">
          <h5 class="mb-0">
            <i class="bi bi-link-45deg me-2"></i>Connected Accounts
          </h5>
        </div>
        <div class="card-body p-4">
          <div class="row g-3">
            {% for base_account in form.accounts %}
            <div class="col-md-6">
              <div class="social-connection-card connected">
                <div class="d-flex align-items-center justify-content-between">
                  <div class="d-flex align-items-center">
                    <div class="social-provider-icon {{ base_account.account.provider }}">
                      {% if base_account.account.provider == "google" %}
                        <i class="bi bi-google"></i>
                      {% elif base_account.account.provider == "facebook" %}
                        <i class="bi bi-facebook"></i>
                      {% elif base_account.account.provider == "github" %}
                        <i class="bi bi-github"></i>
                      {% else %}
                        <i class="bi bi-person-circle"></i>
                      {% endif %}
                    </div>
                    <div class="ms-3">
                      <h6 class="mb-1 fw-bold">{{ base_account.account.get_provider.name }}</h6>
                      <small class="text-muted">{{ base_account.account.extra_data.name|default:base_account.account.uid }}</small>
                    </div>
                  </div>
                  
                  <!-- Disconnect Button -->
                  {% if base_account.account.provider != "openid_connect" %}
                  <button type="button" class="btn btn-sm btn-outline-danger disconnect-btn" 
                          data-account-id="{{ base_account.account.id }}"
                          data-provider="{{ base_account.account.get_provider.name }}">
                    <i class="bi bi-x-circle me-1"></i>Disconnect
                  </button>
                  {% endif %}
                </div>
                
                <div class="connection-status mt-2">
                  <span class="badge bg-success">
                    <i class="bi bi-check-circle me-1"></i>Connected
                  </span>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Available Providers Section -->
      <div class="card shadow-lg border-0">
        <div class="card-header bg-gradient-rose text-white">
          <h5 class="mb-0">
            <i class="bi bi-plus-circle me-2"></i>Add Social Account
          </h5>
        </div>
        <div class="card-body p-4">
          <p class="text-muted mb-4">
            Connect additional social accounts to make logging in even easier. You can use any connected account to sign in to DreamWedAI.
          </p>
          
          <div class="row g-3">
            <!-- Google Connect -->
            <div class="col-md-6">
              <div class="social-connection-card available">
                <div class="d-flex align-items-center justify-content-between">
                  <div class="d-flex align-items-center">
                    <div class="social-provider-icon google">
                      <i class="bi bi-google"></i>
                    </div>
                    <div class="ms-3">
                      <h6 class="mb-1 fw-bold">Google</h6>
                      <small class="text-muted">Connect your Google account</small>
                    </div>
                  </div>
                  
                  <!-- Connect Button -->
                  <a href="{% provider_login_url 'google' process='connect' %}" 
                     class="btn btn-sm btn-gradient-cyan">
                    <i class="bi bi-plus me-1"></i>Connect
                  </a>
                </div>
                
                <div class="connection-status mt-2">
                  <span class="badge bg-secondary">
                    <i class="bi bi-circle me-1"></i>Not Connected
                  </span>
                </div>
              </div>
            </div>
            
            <!-- Future social providers can be added here -->
          </div>
        </div>
      </div>

      <!-- Help Section -->
      <div class="card border-0 bg-light mt-4">
        <div class="card-body p-4">
          <h6 class="fw-bold mb-3">
            <i class="bi bi-question-circle text-primary me-2"></i>About Social Connections
          </h6>
          <div class="row g-3">
            <div class="col-md-6">
              <div class="d-flex align-items-start">
                <i class="bi bi-shield-check text-success me-2 mt-1"></i>
                <div>
                  <strong>Secure & Safe</strong>
                  <p class="text-muted small mb-0">Your social accounts are connected securely and we never store your passwords.</p>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="d-flex align-items-start">
                <i class="bi bi-lightning text-warning me-2 mt-1"></i>
                <div>
                  <strong>Quick Login</strong>
                  <p class="text-muted small mb-0">Skip typing passwords and log in with just one click using your connected accounts.</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="text-center mt-4">
            <a href="{% url 'users:detail' user.username %}" class="btn btn-outline-primary">
              <i class="bi bi-arrow-left me-2"></i>Back to Profile
            </a>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Hidden form for disconnecting accounts -->
<form id="disconnect-form" method="post" action="{% url 'socialaccount_connections' %}" style="display: none;">
  {% csrf_token %}
  <input type="hidden" name="account" id="disconnect-account-id">
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Handle disconnect buttons
  document.querySelectorAll('.disconnect-btn').forEach(button => {
    button.addEventListener('click', function() {
      const accountId = this.dataset.accountId;
      const providerName = this.dataset.provider;
      
      if (confirm(`Are you sure you want to disconnect your ${providerName} account?`)) {
        document.getElementById('disconnect-account-id').value = accountId;
        document.getElementById('disconnect-form').submit();
      }
    });
  });
});
</script>

<style>
.social-connection-card {
  background: white;
  border: 1px solid #e9ecef;
  border-radius: 12px;
  padding: 1.5rem;
  transition: all 0.3s ease;
  position: relative;
}

.social-connection-card:hover {
  border-color: var(--bright-cyan);
  box-shadow: 0 4px 15px rgba(0, 245, 255, 0.15);
  transform: translateY(-2px);
}

.social-connection-card.connected {
  border-left: 4px solid #28a745;
}

.social-connection-card.available {
  border-left: 4px solid #6c757d;
}

.social-provider-icon {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  color: white;
  transition: transform 0.3s ease;
}

.social-provider-icon.google {
  background: linear-gradient(45deg, #4285f4, #34a853);
}

.social-provider-icon.facebook {
  background: linear-gradient(45deg, #1877f2, #42a5f5);
}

.social-provider-icon.github {
  background: linear-gradient(45deg, #333, #666);
}

.social-connection-card:hover .social-provider-icon {
  transform: scale(1.1);
}

.connection-status {
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
}

.btn-gradient-cyan {
  background: linear-gradient(45deg, #00bcd4, #4dd0e1);
  border: none;
  color: white;
  transition: all 0.3s ease;
}

.btn-gradient-cyan:hover {
  background: linear-gradient(45deg, #0097a7, #00bcd4);
  transform: translateY(-1px);
  box-shadow: 0 4px 15px rgba(0, 188, 212, 0.3);
  color: white;
}

.feature-icon {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  color: white;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.disconnect-btn {
  transition: all 0.2s ease;
}

.disconnect-btn:hover {
  transform: translateY(-1px);
}

@media (max-width: 768px) {
  .social-connection-card {
    padding: 1rem;
  }
  
  .social-provider-icon {
    width: 40px;
    height: 40px;
    font-size: 1.2rem;
  }
  
  .connection-status {
    position: static;
    margin-top: 0.5rem;
  }
  
  .disconnect-btn {
    margin-top: 0.5rem;
    width: 100%;
  }
}
</style>
{% endblock content %}