<!-- wedding_shopping/templates/wedding_shopping/couple_manage.html -->
{% extends "base.html" %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
<style>
.form-section {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    margin-bottom: 2rem;
    overflow: hidden;
}

.form-section-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 1rem 1.5rem;
    margin: 0;
    font-weight: 600;
}

.form-section-body {
    padding: 1.5rem;
}

.formset-form {
    border: 1px solid #e9ecef;
    border-radius: 6px;
    padding: 1rem;
    margin-bottom: 1rem;
    background: #f8f9fa;
}

.formset-form:last-child {
    margin-bottom: 0;
}

.brand-indicator {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
}

.url-preview-section {
    background: #e3f2fd;
    border: 1px solid #2196f3;
    border-radius: 6px;
    padding: 1rem;
    margin-bottom: 1.5rem;
}

.required-field label::after {
    content: ' *';
    color: #dc3545;
}
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Header -->
            <div class="text-center mb-4">
                <h1 class="display-5">{{ title }}</h1>
                <p class="lead text-muted">
                    {% if is_new %}
                        Create your beautiful wedding page to share with family and friends
                    {% else %}
                        Update your wedding page details
                    {% endif %}
                </p>
            </div>

            <!-- Main Form -->
            <form method="post" enctype="multipart/form-data" id="wedding-form">
                {% csrf_token %}

                <!-- Basic Wedding Details -->
                <div class="form-section">
                    <h3 class="form-section-header">
                        <i class="bi bi-heart-fill me-2"></i>Wedding Details
                    </h3>
                    <div class="form-section-body">
                        <!-- URL Preview -->
                        <div class="url-preview-section">
                            <label for="url-preview" class="form-label fw-bold">
                                <i class="bi bi-link-45deg me-1"></i>Your Wedding Page URL
                            </label>
                            {{ form.url_preview }}
                            <small class="form-text text-muted">{{ form.url_preview.help_text }}</small>
                        </div>

                        <div class="row">
                            <div class="col-md-6 required-field">
                                <label for="{{ form.partner_1_name.id_for_label }}" class="form-label">{{ form.partner_1_name.label }}</label>
                                {{ form.partner_1_name }}
                                {% if form.partner_1_name.help_text %}
                                    <small class="form-text text-muted">{{ form.partner_1_name.help_text }}</small>
                                {% endif %}
                                {% if form.partner_1_name.errors %}
                                    <div class="text-danger small">{{ form.partner_1_name.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 required-field">
                                <label for="{{ form.partner_2_name.id_for_label }}" class="form-label">{{ form.partner_2_name.label }}</label>
                                {{ form.partner_2_name }}
                                {% if form.partner_2_name.help_text %}
                                    <small class="form-text text-muted">{{ form.partner_2_name.help_text }}</small>
                                {% endif %}
                                {% if form.partner_2_name.errors %}
                                    <div class="text-danger small">{{ form.partner_2_name.errors }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="row mt-3">
                            <div class="col-md-4">
                                <label for="{{ form.wedding_date.id_for_label }}" class="form-label">{{ form.wedding_date.label }}</label>
                                {{ form.wedding_date }}
                                {% if form.wedding_date.help_text %}
                                    <small class="form-text text-muted">{{ form.wedding_date.help_text }}</small>
                                {% endif %}
                                {% if form.wedding_date.errors %}
                                    <div class="text-danger small">{{ form.wedding_date.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-4">
                                <label for="{{ form.venue_name.id_for_label }}" class="form-label">{{ form.venue_name.label }}</label>
                                {{ form.venue_name }}
                                {% if form.venue_name.errors %}
                                    <div class="text-danger small">{{ form.venue_name.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-4">
                                <label for="{{ form.venue_location.id_for_label }}" class="form-label">{{ form.venue_location.label }}</label>
                                {{ form.venue_location }}
                                {% if form.venue_location.help_text %}
                                    <small class="form-text text-muted">{{ form.venue_location.help_text }}</small>
                                {% endif %}
                                {% if form.venue_location.errors %}
                                    <div class="text-danger small">{{ form.venue_location.errors }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="row mt-3">
                            <div class="col-md-6">
                                <label for="{{ form.couple_photo.id_for_label }}" class="form-label">{{ form.couple_photo.label }}</label>
                                {{ form.couple_photo }}
                                {% if form.couple_photo.help_text %}
                                    <small class="form-text text-muted">{{ form.couple_photo.help_text }}</small>
                                {% endif %}
                                {% if form.couple_photo.errors %}
                                    <div class="text-danger small">{{ form.couple_photo.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <label for="{{ form.venue_photo.id_for_label }}" class="form-label">{{ form.venue_photo.label }}</label>
                                {{ form.venue_photo }}
                                {% if form.venue_photo.help_text %}
                                    <small class="form-text text-muted">{{ form.venue_photo.help_text }}</small>
                                {% endif %}
                                {% if form.venue_photo.errors %}
                                    <div class="text-danger small">{{ form.venue_photo.errors }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="mt-3">
                            <label for="{{ form.couple_story.id_for_label }}" class="form-label">{{ form.couple_story.label }}</label>
                            {{ form.couple_story }}
                            {% if form.couple_story.help_text %}
                                <small class="form-text text-muted">{{ form.couple_story.help_text }}</small>
                            {% endif %}
                            {% if form.couple_story.errors %}
                                <div class="text-danger small">{{ form.couple_story.errors }}</div>
                            {% endif %}
                        </div>

                        <div class="form-check mt-3">
                            {{ form.is_public }}
                            <label class="form-check-label" for="{{ form.is_public.id_for_label }}">
                                {{ form.is_public.label }}
                            </label>
                            {% if form.is_public.help_text %}
                                <small class="form-text text-muted d-block">{{ form.is_public.help_text }}</small>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Social Media Section -->
                <div class="form-section">
                    <h3 class="form-section-header">
                        <i class="bi bi-share me-2"></i>Social Media Links
                        <small class="text-white-50 fw-normal ms-2">Optional - Add after creating your page</small>
                    </h3>
                    <div class="form-section-body">
                        <div id="social-formset">
                            {{ social_formset.management_form }}
                            {% if social_formset.non_form_errors %}
                                <div class="alert alert-danger">{{ social_formset.non_form_errors }}</div>
                            {% endif %}
                            
                            {% for form in social_formset %}
                                <div class="formset-form" id="social-form-{{ forloop.counter0 }}">
                                    {% for hidden in form.hidden_fields %}{{ hidden }}{% endfor %}
                                    
                                    <div class="row">
                                        <div class="col-md-3">
                                            <label for="{{ form.platform.id_for_label }}" class="form-label">{{ form.platform.label }}</label>
                                            {{ form.platform }}
                                            {% if form.platform.errors %}
                                                <div class="text-danger small">{{ form.platform.errors }}</div>
                                            {% endif %}
                                        </div>
                                        <div class="col-md-3">
                                            <label for="{{ form.platform_name.id_for_label }}" class="form-label">{{ form.platform_name.label }}</label>
                                            {{ form.platform_name }}
                                            {% if form.platform_name.errors %}
                                                <div class="text-danger small">{{ form.platform_name.errors }}</div>
                                            {% endif %}
                                        </div>
                                        <div class="col-md-3">
                                            <label for="{{ form.url.id_for_label }}" class="form-label">{{ form.url.label }}</label>
                                            {{ form.url }}
                                            {% if form.url.help_text %}
                                                <small class="form-text text-muted">{{ form.url.help_text }}</small>
                                            {% endif %}
                                            {% if form.url.errors %}
                                                <div class="text-danger small">{{ form.url.errors }}</div>
                                            {% endif %}
                                        </div>
                                        <div class="col-md-3">
                                            <label for="{{ form.display_name.id_for_label }}" class="form-label">{{ form.display_name.label }}</label>
                                            {{ form.display_name }}
                                            {% if form.display_name.help_text %}
                                                <small class="form-text text-muted">{{ form.display_name.help_text }}</small>
                                            {% endif %}
                                            {% if form.display_name.errors %}
                                                <div class="text-danger small">{{ form.display_name.errors }}</div>
                                            {% endif %}
                                        </div>
                                    </div>

                                    {% if form.DELETE %}
                                        <div class="form-check mt-2">
                                            {{ form.DELETE }}
                                            <label class="form-check-label text-danger" for="{{ form.DELETE.id_for_label }}">
                                                Delete this social media link
                                            </label>
                                        </div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>

                        <!-- Empty form template for social media -->
                        <div id="social-empty-form" class="formset-form" style="display: none;">
                            {% for form in social_formset.empty_form %}
                                {% for hidden in form.hidden_fields %}{{ hidden }}{% endfor %}
                                
                                <div class="row">
                                    <div class="col-md-3">
                                        <label class="form-label">Platform</label>
                                        {{ form.platform }}
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Platform Name</label>
                                        {{ form.platform_name }}
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">URL</label>
                                        {{ form.url }}
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Display Name</label>
                                        {{ form.display_name }}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- Wedding Registries Section -->
                <div class="form-section">
                    <h3 class="form-section-header">
                        <i class="bi bi-gift me-2"></i>Wedding Registries
                        <small class="text-white-50 fw-normal ms-2">Optional - Add after creating your page</small>
                    </h3>
                    <div class="form-section-body">
                        <div id="registry-formset">
                            {{ registry_formset.management_form }}
                            {% if registry_formset.non_form_errors %}
                                <div class="alert alert-danger">{{ registry_formset.non_form_errors }}</div>
                            {% endif %}
                            
                            {% for form in registry_formset %}
                                <div class="formset-form" id="registry-form-{{ forloop.counter0 }}">
                                    {% for hidden in form.hidden_fields %}{{ hidden }}{% endfor %}
                                    
                                    <div class="row">
                                        <div class="col-md-3">
                                            <label for="{{ form.registry_type.id_for_label }}" class="form-label">{{ form.registry_type.label }}</label>
                                            {{ form.registry_type }}
                                            {% if form.registry_type.errors %}
                                                <div class="text-danger small">{{ form.registry_type.errors }}</div>
                                            {% endif %}
                                        </div>
                                        <div class="col-md-3">
                                            <label for="{{ form.registry_name.id_for_label }}" class="form-label">{{ form.registry_name.label }}</label>
                                            {{ form.registry_name }}
                                            {% if form.registry_name.errors %}
                                                <div class="text-danger small">{{ form.registry_name.errors }}</div>
                                            {% endif %}
                                        </div>
                                        <div class="col-md-6">
                                            <label for="{{ form.original_url.id_for_label }}" class="form-label">{{ form.original_url.label }}</label>
                                            {{ form.original_url }}
                                            {% if form.original_url.help_text %}
                                                <small class="form-text text-muted">{{ form.original_url.help_text }}</small>
                                            {% endif %}
                                            {% if form.original_url.errors %}
                                                <div class="text-danger small">{{ form.original_url.errors }}</div>
                                            {% endif %}
                                        </div>
                                    </div>

                                    <div class="row mt-2">
                                        <div class="col-md-6">
                                            <label for="{{ form.display_name.id_for_label }}" class="form-label">{{ form.display_name.label }}</label>
                                            {{ form.display_name }}
                                            {% if form.display_name.help_text %}
                                                <small class="form-text text-muted">{{ form.display_name.help_text }}</small>
                                            {% endif %}
                                            {% if form.display_name.errors %}
                                                <div class="text-danger small">{{ form.display_name.errors }}</div>
                                            {% endif %}
                                        </div>
                                        <div class="col-md-6">
                                            <label for="{{ form.description.id_for_label }}" class="form-label">{{ form.description.label }}</label>
                                            {{ form.description }}
                                            {% if form.description.help_text %}
                                                <small class="form-text text-muted">{{ form.description.help_text }}</small>
                                            {% endif %}
                                            {% if form.description.errors %}
                                                <div class="text-danger small">{{ form.description.errors }}</div>
                                            {% endif %}
                                        </div>
                                    </div>

                                    {% if form.DELETE %}
                                        <div class="form-check mt-2">
                                            {{ form.DELETE }}
                                            <label class="form-check-label text-danger" for="{{ form.DELETE.id_for_label }}">
                                                Delete this registry
                                            </label>
                                        </div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>

                        <!-- Empty form template for registries -->
                        <div id="registry-empty-form" class="formset-form" style="display: none;">
                            {% for form in registry_formset.empty_form %}
                                {% for hidden in form.hidden_fields %}{{ hidden }}{% endfor %}
                                
                                <div class="row">
                                    <div class="col-md-3">
                                        <label class="form-label">Registry Type</label>
                                        {{ form.registry_type }}
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Registry Name</label>
                                        {{ form.registry_name }}
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Registry URL</label>
                                        {{ form.original_url }}
                                    </div>
                                </div>

                                <div class="row mt-2">
                                    <div class="col-md-6">
                                        <label class="form-label">Display Name</label>
                                        {{ form.display_name }}
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Description</label>
                                        {{ form.description }}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="text-center">
                    <button type="submit" class="btn btn-primary btn-lg me-3">
                        <i class="bi bi-heart-fill me-2"></i>
                        {% if is_new %}Create Wedding Page{% else %}Update Wedding Page{% endif %}
                    </button>
                    <a href="{% url 'wedding_shopping:dashboard' %}" class="btn btn-outline-secondary btn-lg">
                        Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/project.js' %}"></script>
{% endblock %}